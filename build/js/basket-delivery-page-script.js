"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}{const e={pickupModule:document.querySelector(".delivery-pickup")},t=_.extend(e,{pointsWrapper:e.pickupModule.querySelector(".delivery-pickup__points-list"),input:e.pickupModule.querySelector(".delivery-pickup__input"),close:e.pickupModule.querySelector(".delivery-pickup__close"),blockScreen:document.querySelector(".basket__display-block"),confirmButton:e.pickupModule.querySelector(".delivery-pickup__confirm-btn"),deliveryPoints:{city:["Ярославль","Москва","Астрахань","Оренбург","Бузулук","Химки","Санкт-Петербург","Горький","Одесса","Мурманск","Алма-Ата"],address:["Полушкина Роща 16Л","Пушкина 30","Власова 61б","Зелинского 10","Соловьёва 90","Babel 76","Fallout 77","Королёва 35","Бурмистрова 16","Сидорова 47/4","Кирова 11"]}});window.deliveryPickup=_.partial(e=>{const t={handleClass:(e,t,i)=>e.classList[t](i),escapeHtml:e=>{const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])},activateButton:e=>{e.disabled=!1,t.handleClass(e,"remove","delivery-pickup__confirm-btn--deactive")},disableButton:e=>{e.disabled=!0,t.handleClass(e,"add","delivery-pickup__confirm-btn--deactive")},setDataSet:(e,t,i)=>e.dataset[t]=i,clearEl:e=>null},i=e=>{localStorage.setItem("deliveryDate","0"),localStorage.setItem("deliveryAddress",`pickup: ${e}`)},r=({pickupModule:e,pointsWrapper:i,deliveryPoints:o,blockScreen:l})=>(r.initiate=(()=>{const n=(e,i,r,o)=>{const l=e.querySelector(".delivery-pickup__wait-screen");let s=!1;return n.setBlockScreen=(()=>(t.handleClass(o,"remove","hidden"),n)),n.showModule=(()=>(t.handleClass(e,"remove","hidden"),n)),n.setWaitScreen=(()=>(t.handleClass(l,"remove","hidden"),n)),n.checkRender=(()=>(s=e.dataset.rendered,n)),n.fillModule=(()=>(s||(r.city.forEach((e,t)=>i.append(((e,t)=>{const i=document.createElement("p");return i.classList.add("delivery-pickup__point"),i.textContent=`${e}, ${t}`,i})(e,r.address[t]))),e.dataset.rendered="1"),n)),n.disableWaitScreen=(()=>(t.handleClass(l,"add","hidden"),n)),n};return n(e,i,o,l).setBlockScreen().showModule().setWaitScreen().checkRender().fillModule().disableWaitScreen(),r}),r),o=({input:e,pointsWrapper:r,close:l,pickupModule:n,blockScreen:s,confirmButton:a})=>{let c,d,u,p=()=>{},h=()=>{},v=()=>{},y=()=>{},C=()=>{},m=new Event("ClosePickupModule",{bubbles:!0}),f=[],k=n.dataset.deliveryPoint||"";return o.create=(()=>(p=(e=>{const i=t.escapeHtml(e.target.value),o=e=>{const i=e=>e.toLowerCase();let l;return o.getAllPoints=(()=>(c=c||[...r.querySelectorAll(".delivery-pickup__point")],o)),o.inputString=(()=>3>e.length?d?(o.filterPoints("remove"),d=!1,l=!0,o):(l=!0,o):(e=i(e),o)),o.filterPoints=((r="add")=>l?o:([...c].forEach(o=>{const l=i(o.textContent);return 0<e.length&&~l.indexOf(e)?void t.handleClass(o,"remove","hidden"):(t.handleClass(o,r,"hidden"),void(d=!0))}),o)),o};o(i).getAllPoints().inputString().filterPoints()}),p=_.debounce(p,300),h=(e=>{const o=e=>{const l=e.target;let s,c,d;const p=()=>(p.setFastExit=(e=>(s=e,p)),p.setSelected=(e=>(d=e,p)),p.setPrevEl=(e=>(c=e,p)),p.clearSavedInfo=(()=>(t.setDataSet(n,"deliveryPoint",""),localStorage.setItem("deliveryAddress",""),localStorage.setItem("deliveryDate",""),p)),p.clearChosenPoint=(()=>(t.clearEl(u),p)),p.disableButton=(()=>(t.disableButton(a),p)),p.setChosenPoint=(()=>(k=l.textContent,t.setDataSet(n,"deliveryPoint",k),p)),p.activateButton=(()=>(t.activateButton(a),p)),p.saveStorageInfo=(()=>(i(k),p)),p);return o.checkEl=(()=>l.classList.contains("delivery-pickup__point")?(l.classList.contains("delivery-pickup__point--active")?p().setFastExit(!0).setSelected(!0):p().setPrevEl(r.querySelector(".delivery-pickup__point--active")),o):(p().setFastExit(!0),o)),o.saveInfo=(()=>d?(p().clearSavedInfo().clearChosenPoint().disableButton(),o):(s||p().setChosenPoint().activateButton().saveStorageInfo(),o)),o.setStatus=(()=>(s||t.handleClass(l,"add","delivery-pickup__point--active"),d&&t.handleClass(l,"remove","delivery-pickup__point--active"),c&&t.handleClass(c,"remove","delivery-pickup__point--active"),o)),o};o(e).checkEl().saveInfo().setStatus()}),v=(()=>{const i=()=>(i.restorePoints=(()=>([...r.children].forEach(e=>t.handleClass(e,"remove","hidden")),i)),i.hide=(()=>(t.handleClass(n,"add","hidden"),i)),i.inputClear=(()=>(e.value="",i)),i.removeListeners=(()=>(f.forEach(e=>((e,t,i)=>e.removeEventListener(t,i))(e[0],e[1],e[2])),i)),i.disableBlockScreen=(()=>(t.handleClass(s,"add","hidden"),i)),i.blockConfirmButton=(()=>i),i.callCustomEvent=(()=>(n.dispatchEvent(m),i)),i);i().hide().restorePoints().inputClear().removeListeners().blockConfirmButton().disableBlockScreen().callCustomEvent()}),y=(()=>{v()}),C=(()=>{const e=()=>(e.closeModule=(()=>(v(),e)),e.saveInfo=(()=>(i(k),e)),e);e().saveInfo().closeModule()}),o)),o.add=(()=>(f=[[e,"input",p],[r,"click",h],[l,"click",v],[s,"click",y],[a,"click",C]],f.forEach(e=>((e,t,i)=>e.addEventListener(t,i))(e[0],e[1],e[2])),o)),o};r(e).initiate(),o(e).create().add()},t)}{const e={selfExportModule:document.querySelector(".delivery-selfExport"),JCShiptorWidgetPvz:document.querySelector("#shiptor_widget_pvz")},t=_.extend(e,{citiesList:e.selfExportModule.querySelector(".delivery-selfExport__cities-list"),pickupList:e.selfExportModule.querySelector(".delivery-selfExport__pickup-list"),pickupSection:e.selfExportModule.querySelector(".delivery-selfExport__pickup"),citiesSection:e.selfExportModule.querySelector(".delivery-selfExport__cities"),citySearchInput:e.selfExportModule.querySelector(".delivery-selfExport__city-search-input"),pickupSearchInput:e.selfExportModule.querySelector(".delivery-selfExport__pickup-search-input"),close:e.selfExportModule.querySelector(".delivery-selfExport__close"),blockScreen:document.querySelector(".basket__display-block"),errorSection:e.selfExportModule.querySelector(".delivery-selfExport__error"),confirmButton:e.selfExportModule.querySelector(".delivery-selfExport__confirm-btn"),waitScreen:e.selfExportModule.querySelector(".delivery-selfExport__wait-screen"),chosenCity:e.selfExportModule.querySelector(".delivery-selfExport__chosen-city"),changeCity:e.selfExportModule.querySelector(".delivery-selfExport__change-city"),showMap:e.selfExportModule.querySelector(".delivery-selfExport__show-map"),cities:["Абакан","Абинск","Азов","Аксай","Актау","Актобе","Алапаевск","Александров","Алексеевка","Алексин","Алушта","Альметьевск","Амурск","Анапа","Ангарск","Анжеро-Судженск","Апатиты","Апрелевка","Апшеронск","Арамиль","Арзамас","Армавир","Арсеньев","Артем","Архангельск","Асбест","Астрахань","Атырау","Ахтубинск","Ачинск","Аша","Балабаново","Балаково","Балахна","Балашиха","Балашов","Барановичи","Барнаул","Батайск","Бахчисарай","Белая Калитва","Белгород","Белебей","Белово","Белогорск","Белорецк","Белореченск","Бердск","Березники","Березовский","Бийск","Бикин","Биробиджан","Бирск","Благовещенск","Боброво","Бобруйск","Богородск","Бор","Борзя","Борисов","Борисоглебск","Боровичи","Братск","Брест","Бронницы","Брянск","Бугульма","Буденновск","Бузулук","Буй","Булатниковское","Бутово","ВНИИССОК","Валдай","Валуйки","Великие Луки","Великий Новгород","Великий Устюг","Вельск","Верещагино","Верхняя Пышма","Верхняя Салда","Видное","Витебск","Владивосток","Владикавказ","Владимир","Власиха","Волгоград","Волгодонск","Волжск","Волжский","Вологда","Волоколамск","Волхов","Вольск","Воркута","Воронеж","Воскресенск","Воткинск","Всеволожск","Выборг","Выкса","Высокая Гора","Вышний Волочек","Вязники","Вязьма","Вятские Поляны","Гагарина","Гай","Галич","Гатчина","Геленджик","Георгиевск","Глазов","Голицыно","Голышманово","Гомель","Горки-10","Горно-Алтайск","Городец","Горячеводский","Горячий Ключ","Гродно","Грозный","Грэсовский","Грязи","Губаха","Губкин","Губкинский","Гуково","Гусь-Хрустальный","Дедовск","Дербент","Джанкой","Дзержинск","Дзержинский","Димитровград","Динская","Дмитров","Добрянка","Долгопрудный","Домодедово","Донецк","Дубна","Дюртюли","Евпатория","Егорьевск","Ейск","Екатеринбург","Елабуга","Елец","Елизаветинская","Елизово","Ессентуки","Ессентукская","Железноводск","Железногорск","Железнодорожный","Жуковский","Забайкальск","Заводоуковск","Заволжье","Заинск","Заречный","Заринск","Звенигород","Зеленогорск","Зеленоград","Зеленодольск","Зеленокумск","Зерноград","Златоуст","Ивангород","Иваново","Ивантеевка","Игра","Ижевск","Изобильный","Иннополис","Иноземцево","Ирбит","Иркутск","Искитим","Истра","Ишим","Ишимбай","Йошкар-Ола","Казань","Калининград","Калуга","Каменка","Каменск-Уральский","Каменск-Шахтинский","Камышин","Камышлов","Канаш","Кандалакша","Каневская","Канск","Караганда","Касимов","Каспийск","Качканар","Кашира","Кемерово","Керчь","Кизляр","Кимовск","Кимры","Кингисепп","Кинешма","Киржач","Кириши","Киров","Кирово-Чепецк","Кировск","Киселевск","Кисловодск","Клин","Клинцы","Ковров","Когалым","Кокшетау","Коломна","Колпашево","Колпино","Кольцово","Кольчугино","Коммунарка","Комсомольск-на-Амуре","Конаково","Кондопога","Копейск","Кореновск","Королев","Костанай","Кострома","Котельники","Котельнич","Котлас","Кочубеевское","Красная Поляна","Красноармейск","Красногорск","Краснодар","Красное Село","Красное-на-Волге","Краснокамск","Краснообск","Красноперекопск","Краснотурьинск","Красноуфимск","Красноярск","Кронштадт","Кропоткин","Крымск","Кстово","Кубинка","Кувандык","Кудрово","Кудымкар","Кузнецк","Кукмор","Кулебаки","Кунгур","Курган","Курганинск","Куровское","Курск","Курчатов","Кушва","Кызыл","Кызылорда","Кяхта","Лабинск","Лангепас","Ленинградская","Лениногорск","Ленинск-Кузнецкий","Лермонтов","Лесной","Лесной Городок","Лесосибирск","Лида","Ликино-Дулево","Липецк","Лиски","Лобня","Ломоносов","Луга","Луховицы","Лучегорск","Лыткарино","Люберцы","Людиново","Магадан","Магнитогорск","Майкоп","Малаховка","Маркс","Махачкала","Мегион","Междуреченск","Мелеуз","Мехзавод","Миасс","Миллерово","Минеральные Воды","Минск","Минусинск","Мирный","Михайлов","Михайловка","Михайловск","Мичуринск","Могилёв","Можайск","Мончегорск","Морозовск","Москва","Московский","Мурино","Мурманск","Муром","Мытищи","Набережные Челны","Надым","Назарово","Назрань","Нальчик","Наро-Фоминск","Нарьян-Мар","Нахабино","Находка","Невинномысск","Невьянск","Нерехта","Нерюнгри","Нефтекамск","Нефтеюганск","Нижневартовск","Нижнекамск","Нижний Новгород","Нижний Тагил","Нижняя Тура","Новая","Новоалександровск","Новоалтайск","Новое Девяткино","Новозыбков","Новокузнецк","Новокуйбышевск","Новомосковск","Новополоцк","Новороссийск","Новосибирск","Новотроицк","Новоуральск","Новочебоксарск","Новочеркасск","Новошахтинск","Новый Уренгой","Ногинск","Норильск","Ноябрьск","Нур-Султан","Нурлат","Нягань","Обнинск","Обухово","Одинцово","Озерск","Озеры","Октябрьский","Омск","Оренбург","Орехово-Зуево","Орск","Орша","Орёл","Осиново","Островцы","Острогожск","Отрадный","Ош","Павлово","Павловск","Павловская","Павловский Посад","Павлодар","Пенза","Первоуральск","Переславль-Залесский","Пермь","Петергоф","Петрозаводск","Петропавловск","Петропавловск-Камчатский","Пинск","Пограничный","Подольск","Подрезково","Покров","Полевской","Поселок Пироговский","Приморско-Ахтарск","Приозерск","Прокопьевск","Протвино","Прохладный","Псков","Путилково","Пушкин","Пушкино","Пущино","Пятигорск","Раменское","Ревда","Реж","Реутов","Ржев","Рославль","Россошь","Ростов-на-Дону","Рубцовск","Руза","Рузаевка","Рыбинск","Рязань","Саки","Салават","Салехард","Сальск","Салігорск","Самара","Санкт-Петербург","Саранск","Сарапул","Саратов","Саров","Сатка","Сафоново","Саяногорск","Свердловский","Светлоград","Себеж","Севастополь","Северодвинск","Североуральск","Северск","Северская","Селятино","Семенов","Сергиев Посад","Серов","Серпухов","Сертолово","Сестрорецк","Сибай","Симферополь","Славянск-на-Кубани","Смоленск","Снежинск","Советская Гавань","Советский","Сокол","Соликамск","Солнечногорск","Сортавала","Сосновоборск","Сосновый Бор","Сочи","Спасск-Дальний","Ставрополь","Старая Купавна","Старая Русса","Старый Оскол","Стерлитамак","Стрежевой","Строитель","Ступино","Судак","Сургут","Сухой Лог","Сызрань","Сыктывкар","Сысерть","Тавда","Таганрог","Тайшет","Талдыкорган","Тамбов","Тбилисская","Тверь","Тейково","Темиртау","Темрюк","Тимашевск","Тихвин","Тихорецк","Тобольск","Тольятти","Томск","Торжок","Тосно","Трехгорный","Троицк","Туапсе","Туймазы","Тула","Туркестан","Тучково","Тюмень","Ува","Улан-Удэ","Ульяновск","Управленческий","Урай","Уральск","Урюпинск","Усолье-Сибирское","Уссурийск","Усть-Джегута","Усть-Илимск","Усть-Каменогорск","Усть-Кут","Усть-Лабинск","Уфа","Ухта","Учалы","Феодосия","Фролово","Фролы","Фрязино","Хабаровск","Ханты-Мансийск","Хасавюрт","Химки","Хотьково","Цимлянск","Чайковский","Чебаркуль","Чебоксары","Чегдомын","Челябинск","Череповец","Черкесск","Черноголовка","Черногорск","Черноморское","Чернушка","Чехов","Чистополь","Чита","Чудово","Чусовой","Шадринск","Шарыпово","Шатура","Шаховская","Шахты","Шебекино","Шумово","Шушары","Шуя","Шымкент","Щекино","Щелково","Щербинка","Электрогорск","Электросталь","Электроугли","Энгельс","Югорск","Южно-Сахалинск","Южноуральск","Юрга","Юрюзань","Яблоновский","Якутск","Ялта","Ялуторовск","Янино-1","Янтарный","Ярославль","Ярцево"]});window.deliverySelfExport=_.partial(e=>{const t={checkAvailable:(e,t="")=>e||t,getText:e=>e?e.textContent:"",initiateApi:(e,t="77000000000")=>new ShiptorPointsGetter({usersCity:e,fromCity:t}),handleClass:(e,t,i)=>e.classList[t](i),hasClass:(e,t)=>e.classList.contains(t),escapeHtml:e=>{const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])},activateButton:(e,i="delivery-selfExport__confirm-btn--deactive")=>{e.disabled=!1,t.handleClass(e,"remove",i)},disableButton:(e,i="delivery-selfExport__confirm-btn--deactive")=>{e.disabled=!0,t.handleClass(e,"add",i)},setDataSet:(e,t,i)=>e.dataset[t]=i,getDataSet:(e,t)=>e.dataset[t],clearEl:e=>e.innerHTML="",clearInput:e=>e.value="",removeEl:e=>null,hide:e=>t.handleClass(e,"add","hidden"),show:e=>t.handleClass(e,"remove","hidden"),hideAll:e=>[...e].forEach(t.hide),showAll:e=>[...e].forEach(t.show),setText:(e,t)=>e.textContent=t,eventAdd:(e,t,i)=>e.addEventListener(t,i),eventRemove:(e,t,i)=>e.removeEventListener(t,i),isMatch:(e,t)=>e===t,removeListOfEvents:(e,i)=>{e.filter(e=>e[i]).forEach(e=>t.eventRemove(e.el,e.ev,e.listener))},addListOfEvents:(e,i)=>{e.filter(e=>e[i]).forEach(e=>t.eventAdd(e.el,e.ev,e.listener))},setWaitScreen:()=>t.show(e.waitScreen),disableWaitScreen:()=>t.hide(e.waitScreen),lowerCase:e=>e.toLowerCase(),checkSubString:(e,i)=>(e=t.lowerCase(e),i=t.lowerCase(i),!!~e.indexOf(i)),showError:()=>t.show(e.errorSection),hideError:()=>t.hide(e.errorSection),clearStorage:e=>e.forEach(e=>localStorage.setItem(e,"")),filterList:({itemList:e,childClassName:i,wrapper:r,fastExit:o,isCityFiltered:l,firstInitiate:n=!0})=>s=>{const a=t.escapeHtml(s.target.value),c=s=>{let a;return c.initiate=(()=>(n&&(e="pickup"===e?r.querySelector(".delivery-selfExport__pickup-list"):r.querySelector(".delivery-selfExport__cities-list")),n=!1,c)),c.getAllPoints=(()=>(a=[...e.querySelectorAll(i)],c)),c.inputString=(()=>3>s.length?l?(c.filterPoints("remove"),l=!1,o=!0,c):(o=!0,c):(s=t.lowerCase(s),c)),c.filterPoints=((e="add")=>o?c:(a.forEach(i=>t.checkSubString(i.textContent,s)?void t.handleClass(i,"remove","hidden"):(t.handleClass(i,e,"hidden"),void(l=!0))),c)),c.clearClosure=(()=>(o="",c)),c};c(a).initiate().getAllPoints().inputString().filterPoints().clearClosure()}},i={onChangeCity:()=>{},onShowMapClick:()=>{},onPickupConfirm:()=>{},onCityConfirm:()=>{},onCityClick:()=>{},onCityInput:()=>{},onPickupInput:()=>{},onPickupPointClick:()=>{},onCloseClick:()=>{},onBlockScreenClick:()=>{},onMapClose:()=>{}},r=(e,i,r)=>{localStorage.setItem("deliveryDate",t.getDataSet(e,"deliveryPeriod")),localStorage.setItem("deliveryAddress",`delivery: ${i} | ${r}`)},o=({blockScreen:e,selfExportModule:i,pickupList:r,chosenCity:l,pickupSection:n,confirmButton:s,pickupSearchInput:a,JCShiptorWidgetPvz:c})=>(o.initiate=(()=>{const o=()=>{let d,u,p,h,v,y=!1,C=+localStorage.getItem("needRerender");return o.setBlockScreen=(()=>(t.show(e),o)),o.showModule=(()=>(t.show(i),o)),o.showPickupSection=(()=>(t.show(n),o)),o.setWaitScreen=(()=>(t.setWaitScreen(),o)),o.getUserCity=(()=>(d=l.textContent,o)),o.setUserCity=(()=>(d?u=d:(u=YMaps.location.city||"Москва",t.setText(l,u)),o)),o.checkRender=(()=>{const e=()=>(e.getRenderedPoints=(()=>(y=t.getDataSet(i,"renderedPoints"),e)),e.getRenderedCity=(()=>(d!==t.getDataSet(i,"renderedCity")&&(d=""),e)),e.setRenderedCity=(()=>(t.setDataSet(i,"renderedCity",u),e)),e);return e().getRenderedCity().getRenderedPoints().setRenderedCity(),o}),o.disableButton=(()=>(y||t.disableButton(s),o)),o.handleDeliveryPoints=(()=>{if(!y||!d||C){const e=()=>(e.clearLocalRerenderInfo=(()=>(localStorage.setItem("needRerender",""),C=!1,e)),e.cleaPickupInput=(()=>(t.clearInput(a),e)),e.clearPickupList=(()=>(t.clearEl(r),e)),e.initiateApi=(()=>(h=t.initiateApi(u,"77000000000"),e)),e.handleRequest=(()=>{h.getUsersCityKladr().then(e=>{let r;try{r=e.result[0].kladr_id}catch({message:e}){console.log(e),r="11001110011"}return t.setDataSet(i,"cityKladr",r),r}).then(e=>t.setDataSet(c,"cityKladr",e)).then(t=>e.setKladrId(t)).then(()=>window.JCShiptorWidgetPvz.hide()).then(()=>h.calculateShipping()).then(({result:{methods:e}})=>{let r,o;try{r=e[0].min_days}catch({message:e}){console.log(e),r=0}try{o=e[0].max_days}catch({message:e}){console.log(e),o=0}const l=+localStorage.getItem("supplyDate")||0;v=[r+l,o+l],t.setDataSet(i,"deliveryPeriod",o||r)}).then(()=>{h.getDeliveryPoints().then(i=>(1>i.result.length&&t.showError(),e.filterPoints(i))).then(()=>{t.setDataSet(i,"renderedPoints",1),o.checkRender(),d=u}).then(()=>o.disableWaitScreen())})}),e.filterPoints=(({result:t})=>(p=t.filter(e=>e.active),e.renderDeliveryPoints(p),e)),e.renderDeliveryPoints=(e=>{const i=document.createDocumentFragment();e.forEach(e=>{i.append((({courier:e,address:i,work_schedule:r,prepare_address:o})=>{const l=((e,t)=>{let i,r,o;try{o="object"==typeof(e=e||t)?`${i=e.street} ${r=e.house}`:`${(o=(o=t).split(", "))[1]} ${o[2]}`}catch(t){}return o})(o,i);r=t.checkAvailable(r);const n=document.createElement("li");t.handleClass(n,"add","delivery-selfExport__pickup-point"),t.setDataSet(n,"value",l);const s=document.createElement("p");t.handleClass(s,"add","delivery-selfExport__address"),t.setText(s,i);const a=document.createElement("p");t.handleClass(a,"add","delivery-selfExport__work-schedule"),t.setText(a,r);const c=document.createElement("p");t.handleClass(c,"add","delivery-selfExport__shipping-days"),t.setText(c,`Срок доставки: ${v[0]} - ${v[1]} дней`);const d=document.createElement("p");return t.handleClass(d,"add","delivery-selfExport__courier"),t.setText(d,e),n.append(d),n.append(s),n.append(a),n.append(c),n})(e))}),r.append(i)}),e.setKladrId=(t=>(window.JCShiptorWidgetPvz.setParams({location:{kladr_id:t}}),window.JCShiptorWidgetPvz.refresh(),e)),e);return e().clearLocalRerenderInfo().cleaPickupInput().clearPickupList().initiateApi().handleRequest(),o}return o.disableWaitScreen(),o}),o.disableWaitScreen=(async()=>(await t.disableWaitScreen(),o)),o};o().setBlockScreen().showModule().showPickupSection().setWaitScreen().getUserCity().setUserCity().checkRender().disableButton().handleDeliveryPoints()}),o),l=({changeCity:n,showMap:s,confirmButton:a,pickupSection:c,cities:d,citiesList:u,selfExportModule:p,citiesSection:h,citySearchInput:v,pickupSearchInput:y,chosenCity:C,pickupList:m,close:f,blockScreen:k,JCShiptorWidgetPvz:S})=>{let E,g,P=[],x=`${p.dataset.renderedCity}, ${p.dataset.deliveryPoint}`||"",b=t.getText(m.querySelector(".delivery-selfExport__pickup-point--active .delivery-selfExport__courier")),D=new Event("ClosePickupModule",{bubbles:!0});return l.create=(()=>(i.onCityConfirm=(()=>{const i=()=>(i.removeEventListeners=(()=>(t.removeListOfEvents(P,"cityConfirmRemove"),i)),i.addEventListeners=(()=>(t.addListOfEvents(P,"cityConfirmAdd"),i)),i.showAllCities=(()=>(t.showAll(u.children),i)),i.clearPickupData=(()=>{if(!t.getDataSet(p,"deliveryPoint"))return i;const e=()=>(e.clearDataSet=(()=>(t.setDataSet(p,"deliveryPoint",""),e)),e.clearCheckedCity=(()=>{const i=[...m.children].find(e=>t.hasClass(e,"delivery-selfExport__pickup-point--active"));return t.handleClass(i,"remove","delivery-selfExport__pickup-point--active"),e}),e);return e().clearDataSet().clearCheckedCity(),i}),i.hidePickupSection=(()=>(t.hide(h),i)),i);i().removeEventListeners().showAllCities().clearPickupData().addEventListeners().hidePickupSection(),o(e).initiate()}),i.onCityClick=(({target:e})=>{if(t.hasClass(e,"delivery-selfExport__city")||t.hasClass(e,"delivery-selfExport__city-wrapper")){const i=()=>(i.setTextCity=(()=>(t.setText(C,e.textContent),i)),i.markCity=(()=>(t.handleClass(e,"add","delivery-selfExport__city--active"),i)),i.clearData=(()=>(t.setDataSet(p,"deliveryPoint",""),i)),i.clearStorageInfo=(()=>(t.clearStorage(["deliveryDate","deliveryAddress"]),i)),i.unMarkPrevious=(()=>{const e=u.querySelector(".delivery-selfExport__city--active");return e&&t.handleClass(e,"remove","delivery-selfExport__city--active"),i}),i.handleButton=(()=>(t.activateButton(a,"delivery-selfExport__confirm-btn--deactive"),i)),i);i().setTextCity().clearData().clearStorageInfo().unMarkPrevious().markCity().handleButton()}}),i.onCityInput=_.partial(t.filterList,{itemList:"cities",childClassName:".delivery-selfExport__city-wrapper",wrapper:p}),i.onCityInput=_.debounce(i.onCityInput(),300),i.onChangeCity=(()=>{const e=()=>(e.setWaitScreen=(()=>(t.setWaitScreen(),e)),e.hidePickupSection=(()=>(t.hide(c),e)),e.hideErrorSection=(()=>(t.hideError(),e)),e.showCitiesSection=(()=>(t.show(h),e)),e.checkPreviousRender=(()=>(E=t.getDataSet(p,"isCityRendered"),e)),e.renderCitiesList=(()=>{if(!E){const e=e=>{const t=document.createElement("li"),i=document.createElement("p");return i.classList.add("delivery-selfExport__city"),t.classList.add("delivery-selfExport__city-wrapper"),i.textContent=e,t.append(i),t},t=document.createDocumentFragment();d.forEach(i=>t.append(e(i))),u.append(t)}return t.setDataSet(p,"isCityRendered",1),e}),e.disableWaitScreen=(()=>(t.disableWaitScreen(),e)),e.disableConfirmButton=(()=>(t.disableButton(a,"delivery-selfExport__confirm-btn--deactive"),e)),e.clearInput=(()=>(t.clearInput(v),e)),e.removeEventListeners=(()=>(t.removeListOfEvents(P,"changeCityRemove"),e)),e.addEventListeners=(()=>(t.addListOfEvents(P,"changeCityAdd"),e)),e);e().setWaitScreen().hidePickupSection().hideErrorSection().showCitiesSection().checkPreviousRender().renderCitiesList().disableWaitScreen().disableConfirmButton().clearInput().removeEventListeners().addEventListeners()}),i.onPickupInput=_.partial(t.filterList,{itemList:"pickup",childClassName:".delivery-selfExport__pickup-point",wrapper:p}),i.onPickupInput=_.debounce(i.onPickupInput(),300),i.onPickupPointClick=(e=>{const i=({target:e})=>{let o,l,n;const s=()=>(s.setFastExit=(e=>(o=e,s)),s.setSelected=(e=>(n=e,s)),s.setPrevEl=(e=>(l=e,s)),s.clearSavedInfo=(()=>(t.setDataSet(p,"deliveryPoint",""),t.clearStorage(["deliveryDate","deliveryAddress"]),s)),s.clearChosenPoint=(()=>(t.removeEl(g),s)),s.disableButton=(()=>(t.disableButton(a),s)),s.setChosenPoint=(()=>(x=e.querySelector(".delivery-selfExport__address").textContent,b=e.querySelector(".delivery-selfExport__courier").textContent,t.setDataSet(p,"deliveryPoint",t.getDataSet(e,"value")),s)),s.activateButton=(()=>(t.activateButton(a),s)),s.setStorageInfo=(()=>(r(p,x,b),s)),s);return i.checkEl=(()=>{const r=t.lowerCase(e.tagName);return"li"!==r&&"p"!==r?(s().setFastExit(!0),i):("p"===r&&(e=e.parentElement),e.classList.contains("delivery-selfExport__pickup-point--active")?s().setFastExit(!0).setSelected(!0):s().setPrevEl(m.querySelector(".delivery-selfExport__pickup-point--active")),i)}),i.saveInfo=(()=>n?(s().clearSavedInfo().clearChosenPoint().disableButton(),i):(o||s().setChosenPoint().activateButton().setStorageInfo(),i)),i.setStatus=(()=>(o||t.handleClass(e,"add","delivery-selfExport__pickup-point--active"),n&&t.handleClass(e,"remove","delivery-selfExport__pickup-point--active"),l&&t.handleClass(l,"remove","delivery-selfExport__pickup-point--active"),i)),i};i(e).checkEl().saveInfo().setStatus()}),i.onCloseClick=(()=>{const e=()=>(e.restorePoints=(()=>([...m.children].forEach(e=>t.handleClass(e,"remove","hidden")),e)),e.hide=(()=>([p,c,h].forEach(t.hide),e)),e.inputClear=(()=>(y.value="",e)),e.showAllCities=(()=>(t.showAll(u.children),e)),e.removeListeners=(()=>(t.removeListOfEvents(P,"closeModule"),e)),e.disableBlockScreen=(()=>(t.hide(k),e)),e.blockConfirmButton=(()=>e),e.callCustomEvent=(()=>(p.dispatchEvent(D),e)),e);e().hide().restorePoints().inputClear().showAllCities().removeListeners().blockConfirmButton().disableBlockScreen().callCustomEvent()}),i.onBlockScreenClick=(()=>{i.onCloseClick()}),i.onPickupConfirm=(()=>{r(p,x,b),i.onCloseClick()}),i.onShowMapClick=(()=>{}),i.onMapClose=(e=>{const r=()=>(r.handleData=(({detail:{address:e}})=>{const o=()=>{let r;return o.handleGettedAddress=(()=>(e=t.lowerCase(e),o)),o.getChosenPickupFromList=(()=>(r=[...m.children].filter(i=>{const r=t.lowerCase(i.querySelector(".delivery-selfExport__address").textContent);return t.isMatch(r,e)}),o)),o.handleChosenPoint=(()=>r?(r=r[0],i.onPickupPointClick({target:r}),o):void alert("Автоматически пункт выдачи не найден :( \n Попробуйте самостоятельно найти в списке")),o.sortPickupList=(()=>(r.remove(),m.prepend(r),o)),o.clearPreviousSearch=(()=>(i.onPickupInput({target:{value:""}}),o)),o};return o().handleGettedAddress().getChosenPickupFromList().handleChosenPoint().sortPickupList().clearPreviousSearch(),r}),r);r().handleData(e)}),l)),l.listInitiate=(()=>(P=[{el:n,ev:"click",listener:i.onChangeCity,changeCityRemove:!0,cityConfirmAdd:!0,boot:!0,closeModule:!0},{el:s,ev:"click",listener:i.onShowMapClick,changeCityRemove:!0,cityConfirmAdd:!0,boot:!0,closeModule:!0},{el:a,ev:"click",listener:i.onPickupConfirm,changeCityRemove:!0,cityConfirmAdd:!0,boot:!0,closeModule:!0},{el:a,ev:"click",listener:i.onCityConfirm,changeCityAdd:!0,cityConfirmRemove:!0,closeModule:!0},{el:y,ev:"input",listener:i.onPickupInput,changeCityRemove:!0,cityConfirmAdd:!0,boot:!0,closeModule:!0},{el:m,ev:"click",listener:i.onPickupPointClick,changeCityRemove:!0,cityConfirmAdd:!0,boot:!0,closeModule:!0},{el:u,ev:"click",listener:i.onCityClick,changeCityAdd:!0,cityConfirmRemove:!0,closeModule:!0},{el:v,ev:"input",listener:i.onCityInput,changeCityAdd:!0,cityConfirmRemove:!0,closeModule:!0},{el:f,ev:"click",listener:i.onCloseClick,boot:!0,closeModule:!0},{el:k,ev:"click",listener:i.onBlockScreenClick,boot:!0,closeModule:!0},{el:S,ev:"onPvzSelect",listener:i.onMapClose,boot:!0,closeModule:!0}],l)),l.add=(()=>(t.addListOfEvents(P,"boot"),l)),l};o(e).initiate(),l(e).create().listInitiate().add()},t)}class ShiptorPointsGetter{constructor({usersCity:e,fromCity:t}){_defineProperty(this,"_escapeHtml",e=>{const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])}),_defineProperty(this,"_getData",async e=>await fetch("https://api.shiptor.ru/public/v1",{method:"POST",headers:{"Content-Type":"application/json"},body:e}).then(e=>e.json())),_defineProperty(this,"getDeliveryPoints",async()=>{const e=this._dataHandler({method:"getDeliveryPoints",params:{kladr_id:`${this.usersCityKladr}`,cod:"0"}});return await this._getData(e)}),_defineProperty(this,"getUsersCityKladr",async()=>{const e=this._dataHandler({method:"suggestSettlement",params:{query:this.usersCity,country_code:"RU"}});let t=await this._getData(e);try{this.usersCityKladr=t.result[0].kladr_id}catch(t){this.usersCityKladr="00000000000"}return t}),_defineProperty(this,"calculateShipping",async()=>{const e=this._dataHandler({method:"calculateShipping",params:{kladr_id:`${this.usersCityKladr}`,kladr_id_from:"76000001000",cod:"0",length:10,width:10,height:10,weight:1,declared_cost:0}});return await this._getData(e)}),_defineProperty(this,"_dataHandler",e=>{let t=_.clone(this.cityData);return JSON.stringify(_.extend(t,e))}),this.usersCity=this._escapeHtml(e),this.fromCity=t,this.cityData={id:"JsonRpcClient.js",jsonrpc:"2.0",method:""}}}if("https://big1.ru/customers/729/dashboard"===document.querySelector(".b-link-perscab").href){const e={handleClass:(e,t,i)=>e.classList[t](i),cleanEl:e=>e.innerHTML="",initiateScript:(e,t,i)=>e?i():t(),eventAdd:(e,t,i)=>e.addEventListener(t,i),eventRemove:(e,t,i)=>e.removeEventListener(t,i),getSupplyDate:()=>localStorage.getItem("supplyDate"),setSupplyDate:e=>localStorage.setItem("supplyDate",e),setDeliveryDate:e=>localStorage.setItem("deliveryDate",e),activateButton:(t,i="delivery-selfExport__confirm-btn--deactive")=>{t.disabled=!1,e.handleClass(t,"remove",i)},disableButton:(t,i="delivery-selfExport__confirm-btn--deactive")=>{t.disabled=!0,e.handleClass(t,"add",i)}},t={checkActiveGoodies:(t,i,r)=>{const o=[...t.querySelectorAll(".active-price-item")].filter(e=>e.checked);[i,r].forEach(t=>{1>o.length?e.disableButton(t,"basket__btn--blocked"):e.activateButton(t,"basket__btn--blocked")})}},i={pickupModule:document.querySelector(".delivery-pickup"),selfExportModule:document.querySelector(".delivery-selfExport")},r=document.querySelectorAll(".tab-bask tbody tr"),o=document.querySelector(".c-order");e.initiateScript(r[0],()=>{},()=>{const l=r[0].parentNode.parentNode.parentNode;let n,s,a,c,d,u,p,h,v,y=[],C={onPickUpClick:()=>{},onDeliveryClick:()=>{},onDocumentReady:()=>{},onClosePickupModule:()=>{},onDocumentClick:()=>{},onSubmitOrderClick:()=>{}};const m=()=>(m.make=(()=>(s=r[0].cloneNode(!0),s.classList.add("basket__buttons-wrapper"),[...s.children].forEach(e.cleanEl),m)),m.handle=(()=>{const e={secondField:()=>(d=s.children[1],d.textContent="Доставка",e),thirdField:()=>{u=s.children[2],[a,c]=[document.createElement("button"),document.createElement("button")];const t=window.usersCity?`Доставить в ${window.usersCity}?`:"Выбрать город для доставки";return a.textContent="Заберу сам",c.textContent=t,a.classList.add("basket__pickUpBtn"),c.classList.add("basket__deliveryBtn"),[a,c].forEach(e=>u.append(e)),e},firthField:()=>(p=s.children[4],p.textContent="Рассчитайте доставку",e),sixthField:()=>(h=s.children[5],e),eighthField:()=>(v=s.children[7],e)};return e.secondField().thirdField().firthField().sixthField().eighthField(),m}),m.insert=(()=>(l.querySelector("tbody").append(s),m)),m),f=l=>(f.create=(()=>{const o=l.querySelector(".basket-sum"),u=o.parentElement,h=u.querySelector(".c-order"),v=(t,i,o)=>{const a=()=>a;let c=!!(n=l.querySelector(".basket__delivery-output"));return a.create=(()=>c?a:(n=r[0].cloneNode(!0),[...n.children].forEach(e.cleanEl),n.classList.add("basket__delivery-output"),a)),a.fill=(()=>(n.children[2].textContent="Пункт выдачи"===o?`Пункт выдачи: ${i}`:`Самовывоз: ${i}`,a)),a.append=(()=>c?a:(l.querySelector("tbody").insertBefore(n,s),a)),a},y=()=>{const t=()=>{let i=u.querySelector(".basket__common-delivery-period");return t.isElExists=!!i,t.checkConditions=((e,i,r)=>(e?i():r(),t)),t.createEl=(()=>(i=document.createElement("span"),i.classList.add("basket__common-delivery-period"),t)),t.setState=(()=>{const r=()=>{let t,o;return r.getMaxSupplyDate=(()=>(m(),r)),r.getMaxDeliveryDate=(()=>(t=+localStorage.getItem("deliveryDate"),r)),r.handleDeliveryDate=(()=>(t=isFinite(t)?t:0,r)),r.getCommonDate=(()=>(o=+e.getSupplyDate()+ +t,r)),r.fillTheElement=(()=>(i.textContent=` и общим сроком доставки ${o} дн.`,r)),r};return r().getMaxSupplyDate().getMaxDeliveryDate().handleDeliveryDate().getCommonDate().fillTheElement(),t}),t.addElement=(()=>(u.insertBefore(i,o.nextSibling),t)),t};t().checkConditions(t.isElExists,()=>{},t.createEl).setState().checkConditions(t.isElExists,()=>{},t.addElement)},m=()=>{const t=()=>{var i=Math.max;let r,o;return t.getDates=(()=>(r=[...l.querySelectorAll("tbody tr")].filter(e=>e.querySelector("td:nth-of-type(1) input:checked")).map(e=>e.querySelector("td:nth-of-type(5)").textContent),t)),t.handle=(()=>{return o=(o=r.map(e=>{if((e=>!!~e.search(/час/))(e))return 1;if((e=>!!~e.search(/-/))(e)){const t=e.split("-").map(e=>parseInt(e));return i(...t)}return parseInt(e)})).filter(e=>isFinite(e)),_.isEmpty(o)&&(o[0]=0),t}),t.calculateMax=(()=>(e.setSupplyDate(i(...o)),t)),t};t().getDates().handle().calculateMax()};return C.onDocumentReady=(()=>{const i=()=>(i.clearLocalStorage=(()=>(e.setSupplyDate("0"),e.setDeliveryDate("0"),localStorage.setItem("deliveryAddress",""),localStorage.setItem("needRerender",""),i)),i.confirmButtonBlock=(()=>(h.href="#",h.classList.add("basket__confirm-btn--block"),i)),i.calculateDelivery=(()=>(y(),i)),i.checkActiveGoodies=(()=>(t.checkActiveGoodies(l,a,c),i)),i);i().clearLocalStorage().confirmButtonBlock().calculateDelivery().checkActiveGoodies()}),C.onPickUpClick=(e=>{e.preventDefault();const t=()=>(t.callDeliveryPickupModule=(()=>(window.deliveryPickup(),t)),t);t().callDeliveryPickupModule()}),C.onDeliveryClick=(e=>{e.preventDefault(),window.deliverySelfExport()}),C.onClosePickupModule=(({target:e})=>{const t=()=>{let r;try{r=localStorage.getItem("deliveryAddress").split(" | ")[0].split(": ")[1]}catch(e){r=""}const o=e.dataset.deliveryType;let l=!1;return t.checkNecessaryUpdate=(()=>{let e;try{e=n.querySelector(".left").textContent.split(": ")[1]}catch(t){e=""}return r===e&&(l=!0),t}),t.setCommonDeliveryPeriod=(()=>(l||y(),t)),t.setCommonPrice=(()=>t),t.unblockBtns=(()=>(l||(h.href="https://big1.ru/orders/new",h.classList.remove("basket__confirm-btn--block")),t)),t.createRowWInfo=(()=>(l||v(0,r?r.split(" | ")[0]:"пункт не определён",o).create().fill().append(),t)),t.setDeliveryPeriod=(()=>(l||(n.children[4].textContent="Пункт выдачи"===o?`${i.selfExportModule.dataset.deliveryPeriod?i.selfExportModule.dataset.deliveryPeriod:"---"} дн.`:"---"),t)),t.setPrice=(()=>{if(!l){const e="Пункт выдачи"===o?"350.00":"0.00";n.children[5].textContent=n.children[8].textContent=`${e} р.`}return t}),t.clearButtonsWrapper=(()=>(l||(d.textContent="",p.textContent=""),t)),t.setTitle=(()=>(l||(n.children[1].textContent="Доставка"),t)),t.calculateSum=(()=>(replaceCurrentBasketSum(),t)),t};t().checkNecessaryUpdate().setCommonDeliveryPeriod().setCommonPrice().clearButtonsWrapper().unblockBtns().createRowWInfo().setDeliveryPeriod().setPrice().setTitle().calculateSum()}),C.onDocumentClick=(e=>{if(e.target.classList.contains("active-price-item")){const e=()=>(e.setLocalRerenderInfo=(()=>(localStorage.setItem("needRerender","1"),e)),e.rerenderCommonDeliveryInfo=(()=>(y(),e)),e.checkActiveGoodies=(()=>(t.checkActiveGoodies(l,a,c),e)),e);e().setLocalRerenderInfo().rerenderCommonDeliveryInfo().checkActiveGoodies()}}),C.onSubmitOrderClick=(e=>{const t=()=>{let e=!1;return t.preventDefault=(e=>(e.preventDefault(),t)),t.checkInfo=(i=>((()=>!!localStorage.getItem("deliveryAddress"))()||(e=!0),(e=>0!==e.querySelectorAll(".active-price-item:checked").length)(i)||(e=!0),t)),t.saveDeliveryInfo=(()=>t),t.clearStorage=(()=>t),t.redirectToConfirmOrderPage=(()=>(e||location.assign("/orders/new"),t)),t};t().preventDefault(e).checkInfo(l).saveDeliveryInfo().clearStorage().redirectToConfirmOrderPage()}),f}),f.add=(()=>{(y=[[document,"DOMContentLoaded",C.onDocumentReady],[a,"click",C.onPickUpClick],[c,"click",C.onDeliveryClick],[i.pickupModule,"ClosePickupModule",C.onClosePickupModule],[i.selfExportModule,"ClosePickupModule",C.onClosePickupModule],[document,"click",C.onDocumentClick],[o,"click",C.onSubmitOrderClick]]).forEach(t=>e.eventAdd(t[0],t[1],t[2]))}),f);m().make().handle().insert(),f(l).create().add()})}